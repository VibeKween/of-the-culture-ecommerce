<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Cart Thumbnail Diagnostic - OF THE CULTURE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 300;
            background: white;
            color: black;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: -0.02em;
        }

        .device-info {
            background: #f0f9ff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            border-left: 3px solid #007acc;
        }

        .device-info-title {
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: #007acc;
        }

        .device-stat {
            font-size: 0.75rem;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .device-stat strong {
            font-weight: 400;
        }

        .resolution-needed {
            background: #fffbf0;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            border-left: 3px solid #C19A4B;
            font-size: 0.8rem;
        }

        .resolution-needed strong {
            font-weight: 500;
            color: #C19A4B;
        }

        .instructions {
            background: #f5f5f5;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .instructions h3 {
            font-weight: 500;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 6px;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .test-section h2 {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .test-description {
            font-size: 0.75rem;
            margin-bottom: 15px;
            color: #666;
        }

        .comparison-row {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .test-item {
            text-align: center;
            flex: 0 0 auto;
        }

        .test-item img {
            border: 1px solid #ddd;
            margin-bottom: 10px;
            display: block;
        }

        .test-item p {
            font-size: 0.7rem;
            margin-bottom: 3px;
            color: #333;
        }

        .test-item .file-size {
            color: #666;
            font-size: 0.65rem;
        }

        .test-item .verdict {
            font-weight: 500;
            margin-top: 5px;
        }

        .verdict.good {
            color: #2a7d2e;
        }

        .verdict.bad {
            color: #d32f2f;
        }

        .verdict.warning {
            color: #f57c00;
        }

        /* Cart thumbnail styles - EXACT match to cart.css */
        .cart-thumb {
            width: 60px;
            height: 75px;
            object-fit: cover;
            object-position: center top;
        }

        /* Alternative rendering test */
        .cart-thumb-optimized {
            width: 60px;
            height: 75px;
            object-fit: cover;
            object-position: center top;
            image-rendering: -webkit-optimize-contrast;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .highlight-section {
            background: #e8ffe8;
            border-left: 3px solid #2a7d2e;
        }

        .warning-section {
            background: #fff3e0;
            border-left: 3px solid #f57c00;
        }

        .network-info {
            background: #f5f5f5;
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-family: monospace;
        }

        .action-button {
            background: var(--color-black, #000);
            color: white;
            border: none;
            padding: 12px 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s ease;
        }

        .action-button:hover {
            background: #C19A4B;
        }

        .loading {
            display: none;
            margin-top: 10px;
            font-size: 0.75rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Mobile Cart Thumbnail Quality Diagnostic</h1>

        <!-- Device Detection -->
        <div class="device-info">
            <div class="device-info-title">Your Device Information</div>
            <div class="device-stat">
                <span>Device Pixel Ratio:</span>
                <strong id="dpr">Calculating...</strong>
            </div>
            <div class="device-stat">
                <span>Screen Resolution:</span>
                <strong id="screenRes">Calculating...</strong>
            </div>
            <div class="device-stat">
                <span>Viewport Size:</span>
                <strong id="viewportSize">Calculating...</strong>
            </div>
            <div class="device-stat">
                <span>User Agent:</span>
                <strong id="userAgent" style="font-size: 0.65rem; word-break: break-all;">Detecting...</strong>
            </div>
        </div>

        <!-- Resolution Recommendation -->
        <div class="resolution-needed" id="resolutionRec">
            <strong>üìê Calculating optimal thumbnail resolution for your device...</strong>
        </div>

        <!-- Testing Instructions -->
        <div class="instructions">
            <h3>How to Test:</h3>
            <ol>
                <li><strong>Hard Refresh:</strong> Tap and hold the refresh button, select "Hard Reload" to bypass cache</li>
                <li><strong>Compare Images:</strong> Look for differences in sharpness between Current vs. 2x vs. 3x resolution</li>
                <li><strong>Zoom In:</strong> Pinch to zoom on images to see quality differences clearly</li>
                <li><strong>Rate Quality:</strong> Note which version looks sharpest on YOUR device</li>
                <li><strong>Check Network Tab:</strong> If comfortable with DevTools, check actual file sizes delivered</li>
            </ol>
        </div>

        <!-- TEST 1: CRITICAL - Current Thumbnail Quality Assessment -->
        <div class="test-section highlight-section">
            <h2>üîç TEST 1: Current Thumbnail Quality (CRITICAL)</h2>
            <p class="test-description" id="test1-description">
                Look at the NAKAMOTO thumbnail below. This is EXACTLY what you see in the cart.
                <strong>Does it look sharp or blurry on your iPhone 15 Pro?</strong>
            </p>

            <div class="comparison-row">
                <div class="test-item">
                    <img src="images/products/product-pages/nakamoto-thumb.jpg?v=current"
                         class="cart-thumb"
                         alt="NAKAMOTO Current">
                    <p><strong>CURRENT (2x)</strong></p>
                    <p>120x150px @ 100% quality</p>
                    <p class="file-size">10KB - What you see in cart now</p>
                    <p class="verdict warning" id="verdict-current">For 2x displays</p>
                </div>

                <div class="test-item">
                    <img src="images/products/product-pages/nakamoto-thumb-3x.jpg?v=3x"
                         class="cart-thumb"
                         alt="NAKAMOTO 3x">
                    <p><strong>NEW 3x VERSION</strong></p>
                    <p>180x225px @ 100% quality</p>
                    <p class="file-size">21KB - Optimized for iPhone 15 Pro</p>
                    <p class="verdict good" id="verdict-3x">For 3x displays</p>
                </div>
            </div>

            <div style="background: #e8ffe8; padding: 15px; margin-top: 20px; border-radius: 4px; border-left: 3px solid #2a7d2e; font-size: 0.75rem;">
                <p style="margin-bottom: 10px; font-weight: 500;">üéØ CRITICAL TEST - Compare the two thumbnails above:</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Side-by-side:</strong> Look at CURRENT vs NEW 3x side-by-side. Is there a visible difference in sharpness?</li>
                    <li><strong>Pinch to zoom:</strong> Zoom in on both images. Does the 3x version stay sharper?</li>
                    <li><strong>Details:</strong> Can you see fine details better in the 3x version (fabric texture, edges)?</li>
                </ul>
            </div>

            <p style="font-size: 0.75rem; color: #666; margin-top: 15px;" id="verdict-explanation">
                <strong>Decision point:</strong> If the NEW 3x version looks noticeably sharper, we'll implement it in the cart. If they look the same, current files are fine and we save 73KB bandwidth.
            </p>
        </div>

        <!-- TEST 2: All 5 Products Current State -->
        <div class="test-section">
            <h2>üì¶ TEST 2: All Products - Current Cart Quality</h2>
            <p class="test-description">
                These are EXACTLY how thumbnails appear in your cart right now. Do they look sharp or blurry on your mobile device?
            </p>

            <div class="comparison-row">
                <div class="test-item">
                    <img src="images/products/product-pages/nakamoto-thumb.jpg?v=1"
                         class="cart-thumb"
                         alt="NAKAMOTO">
                    <p><strong>NAKAMOTO</strong></p>
                    <p class="file-size">120x150px</p>
                </div>

                <div class="test-item">
                    <img src="images/products/product-pages/openheart-thumb.jpg?v=2"
                         class="cart-thumb"
                         alt="OPENHEART">
                    <p><strong>OPENHEART</strong></p>
                    <p class="file-size">120x150px</p>
                </div>

                <div class="test-item">
                    <img src="images/products/product-pages/dtom-thumb.jpg?v=1"
                         class="cart-thumb"
                         alt="DTOM">
                    <p><strong>DTOM</strong></p>
                    <p class="file-size">120x150px</p>
                </div>
            </div>

            <div class="comparison-row">
                <div class="test-item">
                    <img src="images/products/product-pages/weme-thumb.jpg?v=1"
                         class="cart-thumb"
                         alt="WEME">
                    <p><strong>WE/ME</strong></p>
                    <p class="file-size">120x150px</p>
                </div>

                <div class="test-item">
                    <img src="images/products/product-pages/nodes-thumb.jpg?v=1"
                         class="cart-thumb"
                         alt="NODES">
                    <p><strong>NODES</strong></p>
                    <p class="file-size">120x150px</p>
                </div>
            </div>
        </div>

        <!-- TEST 3: CSS Rendering Optimization -->
        <div class="test-section">
            <h2>üé® TEST 3: CSS Rendering Optimization</h2>
            <p class="test-description">
                Same image, different CSS rendering. Does GPU acceleration or image-rendering help on mobile?
            </p>

            <div class="comparison-row">
                <div class="test-item">
                    <img src="images/products/product-pages/openheart-thumb.jpg?v=standard"
                         class="cart-thumb"
                         alt="OPENHEART Standard">
                    <p><strong>STANDARD CSS</strong></p>
                    <p>object-fit: cover</p>
                    <p class="file-size">No optimizations</p>
                </div>

                <div class="test-item">
                    <img src="images/products/product-pages/openheart-thumb.jpg?v=optimized"
                         class="cart-thumb-optimized"
                         alt="OPENHEART Optimized">
                    <p><strong>GPU ACCELERATED</strong></p>
                    <p>translateZ(0) + crisp-edges</p>
                    <p class="file-size">Rendering optimizations</p>
                </div>
            </div>

            <p style="font-size: 0.75rem; color: #666; margin-top: 10px;">
                <strong>Expected Result:</strong> Minimal difference. If CSS optimizations help significantly, it suggests a browser rendering issue rather than resolution.
            </p>
        </div>

        <!-- TEST 4: Cloudflare Delivery Check -->
        <div class="test-section warning-section">
            <h2>üì° TEST 4: Network Delivery Diagnostic</h2>
            <p class="test-description">
                Check if Cloudflare is auto-compressing images for mobile. This requires browser DevTools.
            </p>

            <button class="action-button" onclick="checkNetworkDelivery()">
                Run Network Diagnostic
            </button>
            <div class="loading" id="loadingIndicator">Checking network delivery...</div>

            <div class="network-info" id="networkResults" style="display: none;">
                <!-- Results will be populated by JavaScript -->
            </div>

            <p style="font-size: 0.75rem; color: #666; margin-top: 15px;">
                <strong>Manual Check:</strong> Open DevTools ‚Üí Network tab ‚Üí Filter "thumb" ‚Üí Look for:
                <br>‚Ä¢ Actual file size vs expected
                <br>‚Ä¢ Cloudflare headers (cf-polished, cf-cache-status)
                <br>‚Ä¢ Image dimensions in response
            </p>
        </div>

        <!-- Feedback Section -->
        <div class="test-section" style="background: #f0f9ff; border-left: 3px solid #007acc;">
            <h2>üìù What Did You Find?</h2>
            <p class="test-description">
                Based on your testing, which statement best describes what you see?
            </p>

            <div style="font-size: 0.8rem; line-height: 1.8;">
                <p><strong>A)</strong> Current thumbnails look SHARP on my mobile device ‚úÖ</p>
                <p><strong>B)</strong> 3x resolution (180x225px) looks SHARPER than current 2x ‚ö†Ô∏è</p>
                <p><strong>C)</strong> All versions look equally BLURRY (suggests other issue) üîç</p>
                <p><strong>D)</strong> GPU-accelerated CSS looks better (rendering issue) üé®</p>
            </div>

            <p style="font-size: 0.75rem; margin-top: 15px; color: #666;">
                Share your findings with this diagnostic info to determine the root cause.
            </p>
        </div>

    </div>

    <script>
        // Device Detection
        function updateDeviceInfo() {
            const dpr = window.devicePixelRatio;
            const screenWidth = screen.width;
            const screenHeight = screen.height;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const ua = navigator.userAgent;

            document.getElementById('dpr').textContent = dpr + 'x';
            document.getElementById('screenRes').textContent = `${screenWidth}√ó${screenHeight}`;
            document.getElementById('viewportSize').textContent = `${viewportWidth}√ó${viewportHeight}`;
            document.getElementById('userAgent').textContent = ua;

            // Calculate recommended resolution
            const cssWidth = 60;
            const cssHeight = 75;
            const physicalWidth = cssWidth * dpr;
            const physicalHeight = cssHeight * dpr;

            let recommendation = '';
            let recommendationClass = '';

            if (dpr >= 3) {
                recommendation = `üö® Your device has ${dpr}x pixel ratio! You need <strong>${physicalWidth}√ó${physicalHeight}px</strong> thumbnails for perfect quality.<br>Current 120√ó150px is under-resolved by ${100 - Math.round((120/physicalWidth)*100)}%.`;
                recommendationClass = 'bad';

                // Update TEST 1 messaging for 3x devices
                const test1Desc = document.getElementById('test1-description');
                if (test1Desc) {
                    test1Desc.innerHTML = `Look at the NAKAMOTO thumbnail below. This is EXACTLY what you see in the cart.<br><strong style="color: #f57c00;">Your iPhone 15 Pro has 3x pixel ratio - if this looks blurry, that's why!</strong>`;
                }

                const verdictExplanation = document.getElementById('verdict-explanation');
                if (verdictExplanation) {
                    verdictExplanation.innerHTML = `<strong>Why this matters:</strong> Your device has a ${dpr}x pixel ratio, requiring <strong>${physicalWidth}√ó${physicalHeight}px</strong> for perfect sharpness. Current 120√ó150px files are ${100 - Math.round((120/physicalWidth)*100)}% under-resolved. <strong style="color: #f57c00;">If thumbnails look blurry, we'll generate 180√ó225px versions.</strong>`;
                }
            } else if (dpr >= 2) {
                recommendation = `‚úÖ Your device has ${dpr}x pixel ratio. Current 120√ó150px thumbnails should look sharp!<br>Optimal resolution: <strong>${physicalWidth}√ó${physicalHeight}px</strong>`;
                recommendationClass = 'good';
            } else {
                recommendation = `‚ÑπÔ∏è Your device has ${dpr}x pixel ratio. Current 120√ó150px thumbnails are more than sufficient.<br>Required resolution: <strong>${physicalWidth}√ó${physicalHeight}px</strong>`;
                recommendationClass = 'good';
            }

            document.getElementById('resolutionRec').innerHTML = recommendation;
        }

        // Network Delivery Check
        function checkNetworkDelivery() {
            const loadingEl = document.getElementById('loadingIndicator');
            const resultsEl = document.getElementById('networkResults');

            loadingEl.style.display = 'block';
            resultsEl.style.display = 'none';

            // Simple performance timing check
            const testImages = [
                'images/products/product-pages/nakamoto-thumb.jpg',
                'images/products/product-pages/openheart-thumb.jpg',
                'images/products/product-pages/dtom-thumb.jpg'
            ];

            let results = '<strong>Network Delivery Results:</strong><br><br>';

            Promise.all(testImages.map(src => {
                return new Promise(resolve => {
                    const img = new Image();
                    const startTime = performance.now();

                    img.onload = function() {
                        const loadTime = Math.round(performance.now() - startTime);
                        const naturalSize = `${this.naturalWidth}√ó${this.naturalHeight}`;
                        const displaySize = `${this.width}√ó${this.height}`;

                        resolve({
                            src: src.split('/').pop(),
                            loadTime,
                            naturalSize,
                            displaySize
                        });
                    };

                    img.src = src + '?t=' + Date.now();
                });
            }))
            .then(imageResults => {
                imageResults.forEach(result => {
                    results += `${result.src}:<br>`;
                    results += `  Natural: ${result.naturalSize}<br>`;
                    results += `  Display: ${result.displaySize}<br>`;
                    results += `  Load Time: ${result.loadTime}ms<br><br>`;
                });

                loadingEl.style.display = 'none';
                resultsEl.innerHTML = results;
                resultsEl.style.display = 'block';
            });
        }

        // Image Load Logging
        document.querySelectorAll('img').forEach(img => {
            img.addEventListener('load', function() {
                console.log(`üì∏ Loaded: ${this.src.split('/').pop()} | Natural: ${this.naturalWidth}√ó${this.naturalHeight} | Display: ${this.width}√ó${this.height}`);
            });
        });

        // Initialize on load
        window.addEventListener('load', updateDeviceInfo);
        window.addEventListener('resize', updateDeviceInfo);
    </script>
</body>
</html>
